<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Whisper Web Transcriber</title>

  <style>
    body {
      background: #0f172a;
      color: #e5e7eb;
      font-family: system-ui, sans-serif;
      display: flex;
      justify-content: center;
      padding-top: 60px;
    }

    .card {
      width: 420px;
      background: #020617;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,.4);
    }

    h2 {
      text-align: center;
      margin-top: 0;
    }

    input[type="file"] {
      width: 100%;
      margin: 12px 0;
    }

    button {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #3b82f6;
      color: white;
      cursor: pointer;
    }

    button:disabled {
      background: #334155;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      font-weight: bold;
      text-align: center;
    }

    .progress {
      width: 100%;
      height: 8px;
      background: #1e293b;
      border-radius: 999px;
      overflow: hidden;
      margin-top: 10px;
      display: none;
    }

    .progress div {
      height: 100%;
      width: 0%;
      background: #22c55e;
      transition: width .4s;
    }

    pre {
      white-space: pre-wrap;
      background: #020617;
      border: 1px solid #1e293b;
      padding: 10px;
      margin-top: 12px;
      border-radius: 8px;
      max-height: 300px;
      overflow-y: auto;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>üéôÔ∏è ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h2>

    <input
      type="file"
      id="file"
      accept=".mp3,.wav,.m4a,.mp4"
    />

    <button id="btn" onclick="start()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ñ‡∏≠‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</button>

    <div class="status" id="status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏ß‡πà‡∏≤‡∏á</div>

    <div class="progress" id="progress">
      <div id="bar"></div>
    </div>

    <pre id="result"></pre>
  </div>

<script>
const SERVER = "http://....ipserver...:5000";
let timer = null;

function setStatus(text) {
  document.getElementById("status").textContent = text;
}

function showProgress(show) {
  document.getElementById("progress").style.display = show ? "block" : "none";
}

async function start() {
  const file = document.getElementById("file").files[0];
  if (!file) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠");
    return;
  }

  document.getElementById("btn").disabled = true;
  document.getElementById("result").textContent = "";
  setStatus("üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡πÑ‡∏ü‡∏•‡πå...");
  showProgress(true);
  document.getElementById("bar").style.width = "30%";

  const form = new FormData();
  form.append("file", file);

  try {
    const res = await fetch(`${SERVER}/transcribe`, {
      method: "POST",
      body: form
    });

    if (!res.ok) throw new Error("upload failed");

    setStatus("üéß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ü‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà...");
    document.getElementById("bar").style.width = "60%";

    timer = setInterval(checkStatus, 1000);

  } catch (err) {
    setStatus("‚ùå Network error");
    showProgress(false);
    document.getElementById("btn").disabled = false;
  }
}

async function checkStatus() {
  const res = await fetch(`${SERVER}/status`);
  const data = await res.json();

  if (data.status === "listening") {
    setStatus("üéß ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏™‡∏µ‡∏¢‡∏á...");
    document.getElementById("bar").style.width = "80%";
  }

  if (data.status === "done") {
    clearInterval(timer);
    setStatus("‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
    document.getElementById("bar").style.width = "100%";
    document.getElementById("result").textContent = data.text;
    document.getElementById("btn").disabled = false;
    showProgress(false);
  }

  if (data.status === "error") {
    clearInterval(timer);
    setStatus("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
    document.getElementById("result").textContent = data.error;
    document.getElementById("btn").disabled = false;
    showProgress(false);
  }
}
</script>
</body>
</html>
